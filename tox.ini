[tox]
envlist = py{310,311,312}, lint, typecheck
isolated_build = true
skip_missing_interpreters = true

[testenv]
description = Run tests with pytest
deps =
    pytest>=7.0
    pytest-asyncio>=0.21
extras = dev
commands =
    pytest {posargs:tests/ -v}

[testenv:lint]
description = Run linting with ruff
basepython = python3
deps =
    ruff>=0.1
commands =
    ruff check src/ tests/
    ruff format --check src/ tests/

[testenv:format]
description = Format code with ruff
basepython = python3
deps =
    ruff>=0.1
commands =
    ruff format src/ tests/
    ruff check --fix src/ tests/

[testenv:typecheck]
description = Run type checking with mypy
basepython = python3
deps =
    mypy>=1.0
    pydantic>=2.0
    pytest>=7.0
    pytest-asyncio>=0.21
commands =
    mypy src/

[testenv:install]
description = Verify package installs correctly
basepython = python3
deps =
commands =
    pip install .
    python -c "from rstmdb import Client; print('Import successful')"

[testenv:dev]
description = Development environment with all tools
basepython = python3
extras = dev
commands =
    python -c "print('Development environment ready')"

[pytest]
asyncio_mode = auto
testpaths = tests
